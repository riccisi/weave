#!/usr/bin/env node
// Genera un file CSS con la safelist di tutte le icone Tabler in formato tailwind 'icon-[tabler--name]'.
import { writeFileSync } from 'node:fs';
import { fileURLToPath } from 'node:url';
import { dirname, join } from 'node:path';
import { createRequire } from 'node:module';
const require = createRequire(import.meta.url);
const tabler = require('@iconify-json/tabler/icons.json');

const __filename = fileURLToPath(import.meta.url);
const __dirname = dirname(__filename);

const outCssPath = join(__dirname, '..', 'src', 'icon-safelist.css');
const outTsPath  = join(__dirname, '..', 'src', 'icon-safelist.ts');
const outHtmlPath = join(__dirname, '..', 'src', 'icon-safelist.html');
const icons = Object.keys(tabler.icons || {});
const rules = icons.map((name) => `.icon-[tabler--${name}] {}`).join('\n');

const css = `/* Generated by scripts/gen-icon-safelist.mjs (${icons.length} icons) */
@layer utilities {
${rules}
}
`;

writeFileSync(outCssPath, css, 'utf8');

const ts = `// Generated by scripts/gen-icon-safelist.mjs\n`+
  `export const iconSafelist = ${JSON.stringify(icons.map((name)=>`icon-[tabler--${name}]`).join(' '))};\n`;
writeFileSync(outTsPath, ts, 'utf8');

const html = `<!-- Generated by scripts/gen-icon-safelist.mjs -->\n<div class="${icons.map((name)=>`icon-[tabler--${name}]`).join(' ')}"></div>\n`;
writeFileSync(outHtmlPath, html, 'utf8');

console.log(`Written ${outCssPath}, ${outTsPath}, ${outHtmlPath} with ${icons.length} icons.`);
